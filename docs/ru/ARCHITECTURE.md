# Архитектура VibeCode

## Обзор системы

VibeCode - это автономная система разработки, построенная на Electron и использующая локальные AI модели через LM Studio.

## Основные компоненты

### 1. Electron Application (`src/`)

**main.js** - Главный процесс Electron
- Создание окна приложения
- IPC обработчики для связи с renderer процессом
- Управление жизненным циклом приложения

**preload.js** - Безопасный IPC мост
- Предоставляет безопасный API для renderer процесса
- Изолирует доступ к Node.js API

**index.html** - UI структура
- HTML разметка интерфейса
- Чат-интерфейс
- Панель управления

**ui.js** - UI логика
- Обработка событий
- Взаимодействие с main процессом через IPC
- Отображение сообщений и логов

### 2. AI Router (`ai/router.js`)

Маршрутизация запросов между различными AI провайдерами:

- **LM Studio** - локальные модели (DeepSeek, Falcon)
- **OpenRouter** - внешние модели (опционально)
- **GPT API** - OpenAI API (опционально)

**Функции:**
- Автоматический выбор модели (Smart Auto Mode)
- Определение языка запроса
- Автоматический перевод для Falcon (русский → английский)
- Fallback механизм

### 3. SelfDev Agent (`agents/selfdev.js`)

Автономный агент для самопрограммирования:

- Чтение Vision.md и Roadmap.md
- Формирование промптов для AI
- Генерация кода через AI Router
- Парсинг и сохранение файлов
- Логирование всех действий
- Отслеживание изменений в документах

**Pipeline:**
```
Vision + Roadmap → Классификация задачи → Выбор модели → 
Перевод (если нужно) → Генерация → Парсинг → Сохранение → Логирование
```

### 4. InterAgent Controller (`agents/inter-agent-controller.js`)

Маршрутизация между различными агентами:

- Определение типа задачи
- Выбор подходящего агента
- Очередь задач
- Передача контекста между агентами

**Поддерживаемые агенты:**
- `selfdev` - самопрограммирование
- `refactor` - рефакторинг (планируется)
- `fix` - исправление ошибок (планируется)
- `patch` - применение патчей (планируется)
- `autocomplete` - автодополнение (планируется)
- `pc-control` - управление ПК (планируется)

### 5. Execution Layer (`lib/execution-layer.js`)

Безопасное выполнение команд и операций:

- Проверка безопасности путей
- Запись и чтение файлов
- Запуск скриптов с таймаутами
- Изоляция выполнения

### 6. Feedback Mechanism (`lib/feedback-mechanism.js`)

Механизм обратной связи и улучшения:

- Регистрация задач и результатов
- Анализ ошибок
- Генерация рекомендаций
- Статистика выполнения

### 7. Project Analyzer (`lib/project-analyzer.js`)

Анализ файловой структуры проектов:

- Рекурсивное сканирование директорий
- Чтение важных файлов (.md, конфиги, код)
- Генерация описания структуры для AI
- Поддержка импорта проектов из Cursor

### 8. Document Watcher (`lib/document-watcher.js`)

Отслеживание изменений в документах:

- Мониторинг Vision.md и Roadmap.md
- Автоматическая перезагрузка контекста
- Уведомления об изменениях

## Поток данных

```
Пользователь (UI)
    ↓
Electron Main Process (main.js)
    ↓
IPC (preload.js)
    ↓
SelfDev Agent
    ↓
AI Router → LM Studio / OpenRouter / GPT
    ↓
Генерация кода
    ↓
Парсинг файлов
    ↓
Execution Layer (безопасное сохранение)
    ↓
Feedback Mechanism (регистрация результата)
    ↓
Логирование
```

## Безопасность

1. **Context Isolation** - renderer процесс изолирован от Node.js
2. **Path Validation** - проверка всех путей перед выполнением
3. **Command Whitelist** - только разрешенные команды
4. **Timeout Protection** - ограничение времени выполнения
5. **Isolated Execution** - изоляция выполнения команд

## Конфигурация

Все настройки в `config.json`:

- AI провайдеры и их параметры
- Пути к Vision и Roadmap
- Настройки Execution Layer
- Smart Auto Mode параметры

## Расширяемость

Система спроектирована для легкого расширения:

- Новые агенты добавляются в InterAgent Controller
- Новые AI провайдеры добавляются в AI Router
- Новые функции Execution Layer легко добавляются
- Feedback Mechanism позволяет улучшать стратегии

## Примеры использования

См. [USAGE.md](../USAGE.md) для подробных инструкций.



