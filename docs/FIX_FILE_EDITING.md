# Исправление проблемы с редактированием файлов

## Проблема

AI перезаписывал файлы полностью вместо того, чтобы дополнять их. При запросе "допиши слово 'тест' в main.js" AI генерировал новый код и перезаписывал весь файл, оставляя только несколько строк.

## Причина

1. Системный промпт не содержал инструкций о работе с существующими файлами
2. AI не понимал разницу между "создать новый файл" и "дополнить существующий"
3. AI не видел текущее содержимое файла перед его изменением

## Решение

### 1. Улучшен системный промпт (`lib/chat-context.js`)

Добавлены инструкции:
- При редактировании существующих файлов AI ДОЛЖЕН предоставлять ПОЛНЫЙ код файла со всеми изменениями
- НЕ предоставлять только фрагменты кода
- Примеры правильного поведения

### 2. Автоматическое чтение существующих файлов

Добавлены функции:
- `extractFileMention()` - извлекает упоминание файла из сообщения пользователя
- `readExistingFile()` - читает существующий файл для контекста
- Автоматическое добавление содержимого файла в системный промпт (первые 2000 символов)

### 3. Восстановление из бэкапа

Файл `main.js` восстановлен из рабочей версии бэкапа.

## Как это работает теперь

1. Пользователь просит: "допиши слово 'тест' в main.js"
2. Система автоматически:
   - Находит упоминание файла `main.js`
   - Читает текущее содержимое файла
   - Добавляет содержимое в системный промпт для AI
3. AI видит текущий код и предоставляет ПОЛНЫЙ файл с изменениями
4. Система сохраняет обновленный файл

## Преимущества

- ✅ AI видит текущее содержимое файла перед изменением
- ✅ AI понимает, что нужно предоставлять полный код
- ✅ Файлы не теряют содержимое при редактировании
- ✅ Работает автоматически, без дополнительных действий

## Примеры запросов

**Правильно работает:**
- "допиши функцию X в main.js"
- "добавь обработчик в ui.js"
- "измени логирование в logger.js"

**Система автоматически:**
- Найдет файл
- Прочитает его содержимое
- Передаст AI для контекста
- AI предоставит полный код с изменениями



