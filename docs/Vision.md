# Vision — VibeCode

## 1. Цель проекта

Создать локальную, максимально автономную IDE, работающую как Cursor, которая:

- Использует локальные модели из LM Studio (DeepSeek-R1 Qwen-3 8B, GPT4All Falcon)
- Может подключать внешние модели (OpenRouter, ChatGPT)
- Имеет автоматический режим, который сам выбирает модель
- Умеет управлять ПК (как Copilot Computer Control)
- Автотестирует код (встроенный тест-раннер)
- Реализует "агентов" (как в Cursor)

---

## 2. Главная архитектура

```
┌───────────────────────────────┐
│ User Interface                │
│ (Monaco Editor + Chat Panel)  │
└───────────────┬───────────────┘
                │
                ▼
┌───────────────────────────────────────┐
│ InterAgent Controller                 │
│ - маршрутизация задач между ИИ       │
│ - авто-режим выбора модели            │
│ - orchestration (context → model)    │
└────────────────┬──────────────────────┘
                 │
┌────────────────┴─────────────────────────┐
│ AI Layer                                  │
│ LM Studio | OpenRouter | GPT              │
│ deepseek | mistral | o1                   │
└────────────────┬─────────────────────────┘
                 │
┌────────────────┴────────────┐
│ Execution Layer              │
│ Автотесты                    │
│ Run Python/JS                 │
│ Управление ПК                 │
└────────────────┬─────────────┘
                 │
            File System
```

---

## 3. Основные компоненты

### 3.1 Electron-приложение

**Основные файлы:**
- `main.js` — создает окно приложения и подгружает preload.js
- `preload.js` — мост между фронтендом и Node.js (безопасный IPC)
- `index.html` — структура интерфейса
- `ui.js` — логика чат-интерфейса и textarea для задач

**Назначение:** Обеспечивает десктопное приложение с веб-интерфейсом и доступом к Node.js API.

### 3.2 AI Router (`ai/router.js`)

**Функциональность:**
- Маршрутизирует запросы между LM Studio, Falcon и OpenRouter
- Минимальная логика выбора модели по типу задачи
- Управление подключениями к различным AI-провайдерам

**Назначение:** Единая точка входа для всех AI-запросов с автоматическим выбором оптимальной модели.

### 3.3 SelfDev Agent (`agents/selfdev.js`)

**Функциональность:**
- Читает `vision.md` и `roadmap.md` для понимания целей проекта
- Генерирует задачи для системы на основе видения
- Создает кодовые файлы по задачам
- Пишет логи действий для отслеживания прогресса

**Назначение:** Автономный агент для самопрограммирования системы на основе видения и roadmap.

### 3.4 Execution Layer

**Компоненты:**
- Минимальный executor: запись файлов, запуск скриптов через Node.js
- Возможность интеграции AutoIt для управления ПК
- Возможность автотестирования (Test Runner)

**Назначение:** Безопасное выполнение команд и управление системой.

---

## 4. Поддержка нескольких AI моделей

### 4.1 LM Studio (локальные модели)

**Используемые модели:**

- **deepseek/deepseek-r1-0528-qwen3-8b**
  - Лучший для reasoning
  - Понимает русский
  - Дешёвый, быстрый
  - Локальный reasoning agent

- **nomic-ai-gpt4all-falcon**
  - Понимает только английский
  - Лучше всего генерирует код
  - Нужен авто-перевод RU → EN → RU

**API:** `POST http://localhost:1234/v1/chat/completions`

### 4.2 OpenRouter

Подключается через: `POST https://openrouter.ai/api/v1/chat/completions` с API key

Даёт доступ к:
- OpenAI o3
- Claude 3.7
- Mistral Large
- Qwen 3 72B

### 4.3 ChatGPT

Поддержка GPT-4.1 и GPT-O1 через официальный API.

### 4.4 Авто-режим выбора модели ("Smart Auto Mode")

**Алгоритм:**
- Если `task.type == "код"` и `model == falcon`: translate(RU→EN) → use falcon → translate(EN → RU)
- Если `task.type == "объяснение"` или `"рефакторинг"`: deepseek
- Если `task.type == "сложный анализ"`: GPT-4.1 или Claude 3.7 via OpenRouter
- Если `task.type == "быстрый ответ"`: deepseek 8B
- Если `task.type == "генерация больших файлов"`: mistral large
- Если сеть недоступна: fallback = deepseek

---

## 5. InterAgent Controller

Основной "мозг" системы.

**Функции:**
- Определяет тип задачи
- Выбирает ИИ модель
- Формирует промпты
- Маршрутизирует код / контекст
- Запускает тесты
- Создаёт патчи (как Cursor diffs)
- Управляет компом (по запросу)

---

## 6. Агентные режимы (Cursor-подобные агенты)

### 6.1 RefactorAgent
- **Input:** code + instructions
- **Output:** improved code

### 6.2 FixAgent
Пытается исправить ошибки, затем запускает автотесты.

### 6.3 ExplainAgent
Объясняет код (DeepSeek).

### 6.4 PatchAgent (как Cursor)
Создаёт diff-патчи:
```diff
@@ -12,7 +12,7 @@
- let a = 10
+ const count = 10
```

### 6.5 AutocompleteAgent (копия Copilot)
Запросы по последним 200 символам.

### 6.6 PC-Control Agent
Управление ПК через AutoIt (планируется).

---

## 7. Автотестирование кода

Система сама создаёт и запускает тесты.

**Поддерживаемые языки:**
- JavaScript (Jest)
- Python (pytest lite встроенный)
- PHP (pest)

**Архитектура:**
```
user → agent → generate tests → run executor → report → apply fix
```

---

## 8. Управление ПК (Automation Agent)

**Функции:**
- Писать по клавиатуре
- Двигать мышь
- Открывать программы
- Переключать окна
- Запускать процессы

**Через:** AutoIt (нативный язык автоматизации Windows)

**Пример:**
```javascript
await pc.moveMouse(100, 200)
await pc.type("npm install")
await pc.key("enter")
```

Модель отвечает "что сделать", а агент выполняет.

---

## 9. Система переводов Falcon <-> Russian

Так как Falcon понимает только английский:

1. DeepSeek переводит RU → EN
2. Falcon генерирует код
3. DeepSeek переводит EN → RU (если нужно объяснение)

AI Controller автоматически делает такой pipeline.

---

## 10. Структура проекта

```
/src
  /main
    main.js
    preload.js
  /agents
    auto.js
    refactor.js
    fix.js
    explain.js
    patch.js
    autocomplete.js
    pc-control.js
  /ui
    index.html
    editor.js
    chat.js
  /core
    ai-controller.js
    translators.js
    router.js
    executor.js
  /test runner/
/ai
  router.js (AI Router)
  profiles.js
  /providers
    lmstudio.js
    openrouter.js
    openai.js
    ollama.js
    custom.js
```

---

## 11. Требования к минимальному старту

### 11.1 Технологический стек

1. **Node.js + npm** — среда выполнения
2. **Electron** — фреймворк для десктопного приложения
3. **LM Studio** — локально установленное с моделями:
   - DeepSeek-R1
   - Falcon
4. **Возможность POST-запросов** к LM Studio API

### 11.2 Структура проекта

```
/src
  main.js          # Точка входа Electron
  preload.js       # IPC мост
  index.html       # UI структура
  ui.js            # UI логика
/ai
  router.js        # AI маршрутизатор
/agents
  selfdev.js       # SelfDev агент
/docs
  vision.md        # Видение проекта
  roadmap.md       # План развития
```

---

## 12. Цели ближайшего старта

### 12.1 Минимальный рабочий проект

- Создать базовую структуру Electron-приложения
- Реализовать простой чат-интерфейс
- Настроить подключение к LM Studio
- Реализовать базовый AI Router

### 12.2 Self-Build функциональность

- Кнопка «Self-Build» для генерации первых файлов
- ИИ должен уметь читать `vision.md` и `roadmap.md`
- Генерация кода на основе видения проекта
- Логирование всех действий

### 12.3 Подготовка к самопрограммированию

- Архитектура для автономной разработки
- Система задач и их выполнение
- Механизм обратной связи и улучшения

### 12.4 Планируемые агенты (будущее развитие)

- **Refactor Agent** — рефакторинг кода
- **Fix Agent** — исправление ошибок
- **Explain Agent** — объяснение кода
- **Patch Agent** — применение патчей
- **Autocomplete Agent** — автодополнение
- **PC-Control Agent** — управление ПК через AutoIt

---

## 13. Принципы разработки

### 13.1 Модульность

Все компоненты должны быть независимыми модулями с четкими интерфейсами.

### 13.2 Расширяемость

Архитектура должна позволять легко добавлять новые агенты, модели и функции.

### 13.3 Безопасность

Выполнение кода должно быть изолированным и контролируемым.

### 13.4 Логирование

Все действия системы должны логироваться для отслеживания и отладки.

---

## 14. Долгосрочное видение

VibeCode должен стать автономной системой разработки, которая:

1. **Самостоятельно развивается** на основе vision и roadmap
2. **Выбирает оптимальные модели** для различных типов задач
3. **Управляет компьютером** для выполнения сложных задач
4. **Тестирует свой код** перед применением изменений
5. **Обучается** на основе результатов своей работы

---

## 15. Ключевые метрики успеха

- ✅ Система запускается и подключается к LM Studio
- ✅ Чат-интерфейс принимает команды и получает ответы
- ✅ Self-Build генерирует рабочие файлы
- ✅ AI Router корректно выбирает модели
- ✅ SelfDev Agent читает vision и roadmap
- ✅ Система может создавать и сохранять файлы
- ✅ Переключение между провайдерами работает
- ✅ Автоматический перевод для Falcon работает

---

*Документ создан для описания видения проекта VibeCode*
