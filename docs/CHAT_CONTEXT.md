# Система контекста чата

## Описание

Реализована система управления контекстом для чата, которая предоставляет AI полную информацию о проекте, истории разговора и возможностях системы.

## Компоненты

### 1. ChatContextManager (`lib/chat-context.js`)

Модуль для управления контекстом чата:

- **Анализ структуры проекта** - автоматически сканирует проект и формирует описание структуры
- **История разговора** - хранит последние 10 сообщений в памяти (краткосрочная память)
- **Системный промпт** - формирует полный промпт с контекстом для AI
- **Интеграция с БД** - работает с базой знаний для долгосрочной памяти

### 2. Интеграция в main.js

- Автоматическая инициализация при старте приложения
- Использование системного промпта перед отправкой запроса в AI
- Сохранение истории разговора
- Сохранение в базу знаний для долгосрочной памяти

## Возможности

### Системный промпт включает:

1. **Информацию о возможностях AI:**
   - Сохранение файлов в правильном формате
   - Понимание структуры проекта

2. **Структуру проекта:**
   - Основные директории
   - Важные файлы с описаниями
   - Структура исходников

3. **Историю разговора:**
   - Последние 5 сообщений
   - Временные метки
   - Роли (пользователь/AI)

4. **Важные пути:**
   - Корень проекта
   - Директории исходников
   - Конфигурационные файлы

5. **Формат ответов:**
   - Правильный формат блоков кода
   - Указание путей к файлам
   - Требования к структуре ответов

## Использование

Система работает автоматически. При отправке сообщения в чат:

1. Сообщение добавляется в историю
2. Формируется системный промпт с контекстом
3. Запрос отправляется в AI с полным контекстом
4. Ответ сохраняется в историю и базу знаний

## Пример системного промпта

```
[СИСТЕМНЫЙ КОНТЕКСТ VibeCode]

Ты - AI ассистент в системе VibeCode - автономной IDE для разработки на основе Electron.

ТВОИ ВОЗМОЖНОСТИ:
1. Сохранение файлов: когда пользователь просит создать/изменить файл, предоставь код в формате:
   ```src/path/to/file.js
   // код файла
   ```

2. Структура проекта:
   [Автоматически сгенерированное описание]

3. История разговора:
   [Последние 5 сообщений]

4. Важные пути:
   - Корень проекта: C:\CursorX
   - Исходники: C:\CursorX\src
   ...

[КОНЕЦ КОНТЕКСТА]

Запрос пользователя: [сообщение пользователя]
```

## Преимущества

- ✅ AI понимает структуру проекта
- ✅ AI помнит контекст разговора
- ✅ AI знает, как правильно сохранять файлы
- ✅ История сохраняется для анализа
- ✅ Интеграция с базой знаний для долгосрочной памяти

## Технические детали

- **Кеширование структуры проекта:** 5 минут
- **Максимум сообщений в истории:** 10
- **Глубина сканирования проекта:** 2 уровня вложенности
- **Автоматическое обновление:** при изменении проекта




